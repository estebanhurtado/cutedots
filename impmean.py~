import numpy as np
import scipy.stats as st

def average(rows):
    n = rows.shape[0]
    factors = np.ones(n, dtype=float) / n
    for i in range(10):
        avg = np.sum(rows*factors, 0)
        r = [st.pearsonr(x, avg)[0] for x in rows]
        rsq = r**2
        factors = rsq / np.sum(rsq)
    return np.sum(rows*factors, 0)
